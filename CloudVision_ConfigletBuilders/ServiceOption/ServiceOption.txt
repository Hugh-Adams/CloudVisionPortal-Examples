{"data":{"configletBuilder":[{"isAssigned":false,"formList":[{"fieldId":"interface","fieldLabel":"Interface","type":"Drop down","value":"Ethernet7,Ethernet8,Ethernt9","depends":"","validation":{"mandatory":true},"dataValidation":"","helpText":"Chose Ethernet7!!","configletBuilderId":"configletBuilderMapper_711_283648283154574","orderId":0,"key":"fieldId_707_283648253290705","dataValidationErrorExist":false,"previewValue":""},{"fieldId":"serviceList","fieldLabel":"Required Services","type":"Check box","value":"service1,service2,service3","depends":"","validation":{"mandatory":true},"dataValidation":"","helpText":"PLease select all services required","configletBuilderId":"configletBuilderMapper_711_283648283154574","orderId":1,"key":"fieldId_708_283648253302841","dataValidationErrorExist":false,"previewValue":""},{"fieldId":"action","fieldLabel":"Radio button","type":"Radio button","value":"add,update,remove","depends":"","validation":{"mandatory":false},"dataValidation":"","helpText":"what do you want to do?","configletBuilderId":"configletBuilderMapper_711_283648283154574","orderId":2,"key":"fieldId_709_283648253311823","dataValidationErrorExist":false,"previewValue":""}],"name":"ServiceOptions","type":"Builder","main_script":{"data":"import json\nimport re\nfrom cvplibrary import Form, CVPGlobalVariables, GlobalVariableNames\n\n# Dummy Service Data Base location\nfilename = \"\/home\/cvp\/servicesDb.json\"\n\n# Get focus on a switch for testing\n#CVPGlobalVariables.setNetElement( \"00:50:56:3e:bf:5d\" )\n#CVPGlobalVariables.setNetElement( \"00:50:56:fd:bd:51\" )\n\n#Import service db for switch info\nwith open(filename, 'r') as fp:\n    db = json.load(fp)\n\n# Get the list of services to be processed\nservices = re.split(',',Form.getFieldById('serviceList').getValue())\n# Get required action (add, remove, update)\naction = Form.getFieldById('action').getValue()\n# Get which interface the service are for\ninterface = Form.getFieldById('interface').getValue()\n\n\n# Build simple config example\nprint \"! Services Configlet Builder start\"\nprint '!'\n\nif len(services) == 0:\n  print \"No Services selected\"\nelse:\n  if action == \"add\":\n    for service in services:\n      if service in db:\n        vlan = db[service]['vlan']\n        vlanName = db[service]['name']\n        print \"vlan %s\" % vlan\n        print \"name %s-Service\" % vlanName\n        print \"exit\"\n        print \"interface %s\" % interface\n        print \"switchport trunk allowed vlan add %s\" %vlan\n        print \"exit\"\n      \n  elif action == \"update\":\n    for service in services:\n      if service in db:\n        vlan = db[service]['vlan']\n        print \"interface %s\" % interface\n        print \"switchport trunk allowed vlan add %s\" %vlan\n        print \"exit\"\n        \n  elif action == \"remove\":\n    for service in services:\n      if service in db:\n        vlan = db[service]['vlan']\n        print \"interface %s\" % interface\n        print \"switchport trunk allowed vlan remove %s\" %vlan\n        print \"exit\"\n\nprint '!'\nprint \"! Services Configlet Builder end\"","key":null}}],"configlet":[]}}